-- Databricks notebook source
-- MAGIC %md
-- MAGIC #1- Creaci√≥n de tablas en formato texto.

-- COMMAND ----------

-- DBTITLE 1,Crear Base de datos "datos_padron"
CREATE DATABASE datos_padron

-- COMMAND ----------

USE datos_padron

-- COMMAND ----------

-- DBTITLE 1,Crear la tabla de datos
CREATE TABLE padron_txt (COD_DISTRITO INT,DESC_DISTRITO STRING,
COD_DIST_BARRIO INT, DESC_BARRIO STRING,
COD_BARRIO INT,COD_DIST_SECCION INT,COD_SECCION INT,COD_EDAD_INT INT, EspanolesHombres INT,EspanolesMujeres INT,ExtranjerosHombres INT,ExtranjerosMujeres INT) 
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
WITH SERDEPROPERTIES (
"separatorChar" = '\073',
"quoteChar" = '"',
"escapeChar" = '\\'
)
STORED AS TEXTFILE
TBLPROPERTIES("skip.header.line.count"="1");

-- COMMAND ----------

-- MAGIC %md
-- MAGIC Se suben los datos a hadoop y se visualizan para comrpobar que se ha hecho correctamente
-- MAGIC 
-- MAGIC hadoop fs -put Rango_Edades_Seccion_202204.csv /user/cloudera/hive/
-- MAGIC 
-- MAGIC hadoop fs -ls -R

-- COMMAND ----------

-- DBTITLE 1,Cargar datos
LOAD DATA INPATH '/user/cloudera/hive/Rango_Edades_Seccion_202204.csv' INTO TABLE datos_padron.padron_txt

-- COMMAND ----------

-- DBTITLE 1,eliminar los espacios innecesarios y guardandolo en una nueva tabla
CREATE TABLE padron_txt_2 AS
SELECT TRIM(COD_DISTRITO) AS COD_DISTRITO, TRIM(DESC_DISTRITO) AS DESC_DISTRITO, TRIM(COD_DIST_BARRIO) AS COD_DIST_BARRIO, TRIM(DESC_BARRIO) AS DESC_BARRIO, TRIM(COD_BARRIO) AS COD_BARRIO, TRIM(COD_DIST_SECCION) AS COD_DIST_SECCION, TRIM(COD_SECCION) AS COD_SECCION, TRIM(COD_EDAD_INT) AS COD_EDAD_INT, TRIM(EspanolesHombres) AS EspanolesHombres, TRIM(EspanolesMujeres) AS EspanolesMujeres, TRIM(ExtranjerosHombres) AS ExtranjerosHombres, TRIM(ExtranjerosMujeres) AS ExtranjerosMujeres
FROM padron_txt;

-- COMMAND ----------

-- MAGIC %md
-- MAGIC Diferencia de incluir la palabra LOCAL en el comando LOAD DATA:
-- MAGIC 
-- MAGIC Con la palabra local se buscan en el sistema de archivos local, mientras que si se omite se busca el archivo en HDFS

-- COMMAND ----------

-- DBTITLE 1,Sustituir espacios en blanco por 0 

